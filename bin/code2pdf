#!/usr/bin/env bash

# Get the directory where the script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
INSTALL_DIR="$(dirname "$SCRIPT_DIR")"

# Help text
show_help() {
    echo "Usage: code2pdf [OPTIONS] <file or directory>"
    echo ""
    echo "Options:"
    echo "  -s, --single FILE    Convert a single file to PDF"
    echo "  -a, --all DIR        Convert all source files in directory"
    echo "  -h, --help           Show this help message"
    echo ""
    echo "Examples:"
    echo "  code2pdf -s myfile.py        # Convert single file"
    echo "  code2pdf -a src/             # Convert all files in directory"
}

# Check dependencies
check_dependencies() {
    local missing=()
    for cmd in vim gs jq; do
        if ! command -v $cmd &> /dev/null; then
            missing+=($cmd)
        fi
    done
    
    if [ ${#missing[@]} -ne 0 ]; then
        echo "Error: Missing required dependencies: ${missing[*]}"
        echo "Please install them using: brew install ${missing[*]}"
        exit 1
    fi
}

# Main logic
main() {
    check_dependencies

    case "$1" in
        -s|--single)
            shift
            "$INSTALL_DIR/scripts/print_single_file_to_pdf.sh" "$1" "$(pwd)"
            ;;
        -a|--all)
            shift
            "$INSTALL_DIR/scripts/print_all.sh" "$1" "$INSTALL_DIR/config/vimrc"
            ;;
        -h|--help)
            show_help
            ;;
        *)
            show_help
            exit 1
            ;;
    esac
}

main "$@"
